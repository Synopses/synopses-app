<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="bower_components/paper-input/paper-input.html">
<link rel="import" href="bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="bower_components/gold-email-input/gold-email-input.html">

<dom-module id="patient-form">
<style>
:host paper-dialog {
  padding: 0 20px;
}

:host .inline paper-input {
  float:left;
}
</style>
<template>
  <paper-icon-button on-tap="openDialog" data-dialog="patient-dialog" icon="add"></paper-icon-button>

  <paper-dialog id="patient-dialog">
    <h2>{{ title }}</h2>
    <paper-dialog-scrollable>
      <form is="iron-form" id="patient-details" method="post" action="/api/patient/save">
        <table>
        <tr><td>
          <paper-input name="first_name" label="First name"></paper-input>
          <paper-input name="last_name" label="Last name"></paper-input>
          <gold-email-input name="email" label="Email address" auto-validate></gold-email-input>
          <paper-input name="phone1" label="Phone number"></paper-input>
          <paper-input name="phone2" label="Mobile number"></paper-input>
        </td><td>
          <paper-input name="address1" label="Address"></paper-input>
          <paper-input name="address2" label="Address 2"></paper-input>
          <paper-input name="city" label="City"></paper-input>
          <paper-input name="postal" label="Postal code" value="CH-"></paper-input>
          <paper-input name="country" label="Country" value="Switzerland"></paper-input>
        </td></tr><tr><td>
          <paper-input name="date_birth" label="Date of birth" value="01.01.1900"></paper-input>
        </td><td class="inline">
          <input name="sex_code" label="Female" type="radio" value="2" checked>Female
          <input name="sex_code" label="Male" type="radio" value="1">Male
        </td></tr>
        </table>
      </form>
    </paper-dialog-scrollable>
    <div class="buttons">
      <paper-button dialog-dismiss>Cancel</paper-button>
      <paper-button on-tap="saveDialog" dialog-confirm autofocus>Save</paper-button>
    </div>
  </paper-dialog>
</template>
<script>
  Polymer({
    is: 'patient-form',
    obj: null,

    properties: {
      title: {
        value: "Patient details",
        reflectToAttribute: true
      }
    },

    openDialog: function(e) {
      var button = e.target;
      while (!button.hasAttribute('data-dialog') && button !== document.body) {
        button = button.parentElement;
      }
      if (!button.hasAttribute('data-dialog')) {
        return;
      }

      var id = button.getAttribute('data-dialog');
      this.dialog = document.getElementById(id);

      if (this.dialog) {
        this.dialog.open();
      }
    },

    saveDialog: function(e) {
      var self = this.dialog;
      setTimeout(function() {
        self.open();
      }, 50);
      //document.getElementById('patient-details').submit();
      //this.fire('patient-saved');
    }

  });
</script>
</dom-module>
