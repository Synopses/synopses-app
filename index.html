<!-- Author: Eric Bidelman <@ebidel> -->
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1">
  <title>Synopses</title>

  <meta name="apple-mobile-web-app-capable" content="yes">
  <!-- Fallback for manifest.json add to homescreen (Chrome Android) -->
  <meta name="mobile-web-app-capable" content="yes">

  <meta name="apple-mobile-web-app-status-bar-style" content="#e32d43">
  <meta name="msapplication-TileColor" content="#e32d43">
  <meta name="msapplication-tap-highlight" content="no">
  <meta name="theme-color" content="#e32d43">

  <link rel="icon" sizes="192x192" href="images/synopses-icon.png">

  <link rel="manifest" href="manifest.json">

  <link rel="stylesheet" href="app.css">

  <!-- Polyfill webcomponents in browsers that don't support it. -->
  <script src="bower_components/webcomponentsjs/webcomponents-lite.min.js"></script>

  <!-- <link rel="import" href="vulcanized.html"> -->
  <link rel="import" href="elements.html">
</head>
<body class="fullbleed">

<template id="t" is="dom-bind">

<div id="loginscreen"
     class$="[[_computeLoginScreenClass(isAuthenticated, 'layout vertical center-center fit')]]"
     hidden="{{DEBUG}}">
     <login-polyform on-login="handleLogin" credentials="{{_user}}">
      <img avatar src="images/synopses-icon.png"/>
      <iron-ajax
        id="ajax-login"
        url="/api/login"
        method="POST"
        content-type="application/json"
        last-response="{{_response}}"></iron-ajax>
    </login-polyform>
  <!--google-signin width="wide" height="tall"
      client-id="229000986068-hld1d9ovioamaaur218vg3jg5dgvf2a2.apps.googleusercontent.com"
      scopes="https://www.googleapis.com/auth/plus.login https://www.googleapis.com/auth/gmail.readonly"
      on-google-signin-success="onSigninSuccess"
      on-google-signed-out="onSignOut"
      on-google-signout-attempted="onSignOutAttempt"
      on-google-signin-aware-signed-out="onSignInAwareSignout"
      on-google-signin-failure="onSigninFailure"
      signed-in="{{signedIn}}"></google-signin-->
</div>

<patient-form ident="addpatient" title="Add patient" on-patient-saved="loadPatients"></patient-form>

<record-form ident="addrecord" title="New record"
  patientid="{{selectedPatient.id}}"
  on-record-saved="loadRecords"></record-form>

<paper-drawer-panel id="drawerPanel" narrow="{{narrow}}">

  <paper-header-panel mode="scroll" drawer>
    <paper-toolbar id="navheader" class="narrow">
      <material-search id="search" narrow="[[narrow]]" class="fit" active></material-search>
    </paper-toolbar>
    <paper-menu selectable="paper-icon-item" on-iron-select="menuSelect">
      <paper-icon-item role="menuitem" on-tap="inboxSelect">
        <iron-icon icon="mail" item-icon></iron-icon>Inbox
      </paper-icon-item>
      <div class="separator" style="border-top:none">Today</div>
      <template is="dom-repeat" items="{{patientstoday}}">
        <paper-icon-item class="patient" on-tap="patientSelect">
          <profile-img id="profileimage" item-icon
                       src="{{item.photo}}"></profile-img>
          <span>{{item.name}}</span>
        </paper-icon-item>
      </template>
      <div class="separator">Yesterday</div>
      <template is="dom-repeat" items="{{patientspast}}">
        <paper-icon-item class="patient" on-tap="patientSelect">
          <profile-img id="profileimage" item-icon
                       src="{{item.photo}}"></profile-img>
          <span>{{item.name}}</span>
        </paper-icon-item>
      </template>
      <div class="separator">Last week</div>
      <!--
      <paper-icon-item role="menuitem">
        <iron-icon icon="social:people" item-icon></iron-icon>Social
      </paper-icon-item>
      <div class="separator">Shortcuts</div>
      <paper-icon-item role="menuitem">
        <iron-icon icon="star" item-icon></iron-icon>Starred
      </paper-icon-item>
      <paper-icon-item role="menuitem">
        <iron-icon icon="send" item-icon></iron-icon>Sent
      </paper-icon-item>
      <paper-icon-item role="menuitem">
        <iron-icon icon="icons:drafts" item-icon></iron-icon>Drafts
      </paper-icon-item>
      <paper-icon-item role="menuitem">
        <iron-icon icon="mail" item-icon></iron-icon>All Mail
      </paper-icon-item>
      <paper-icon-item role="menuitem">
        <iron-icon icon="report" item-icon></iron-icon>Spam
      </paper-icon-item>
      <paper-icon-item role="menuitem">
        <iron-icon icon="delete" item-icon></iron-icon>Trash
      </paper-icon-item>
      <template is="dom-repeat" items="{{labels}}">
        <paper-icon-item class$="{{item.color}}">
          <iron-icon icon="label" item-icon></iron-icon><span>{{item.name}}</span>
        </paper-icon-item>
      </template>
    -->
    </paper-menu>
  </paper-header-panel>

  <paper-scroll-header-panel id="scrollheader" main
      keep-condensed-header condenses="{{!narrow}}" fixed="{{narrow}}"
      on-trackstart="onRefreshStart"
      on-tracky="onMainAreaTrack"
      on-trackend="onRefreshUp">

    <paper-toolbar id="mainheader" class$="[[headerClass]]">
      <paper-icon-button icon="arrow-back" class="selected-item" on-tap="deselectAll"></paper-icon-button>

      <paper-icon-button id="navicon" icon="menu" paper-drawer-toggle></paper-icon-button>
      <div class="flex"></div>

      <span class="top indent title">{{headerTitle}}</span>

      <paper-icon-button icon="archive" class="selected-item" on-tap="archiveAll"></paper-icon-button>
      <paper-icon-button icon="delete" class="selected-item"></paper-icon-button>
      <paper-icon-button icon="mail" class="selected-item"></paper-icon-button>

      <!-- <paper-menu-button class="selected-item" class="layout horizontal">
        <paper-icon-button icon="more-vert"></paper-icon-button>
        <paper-dropdown class="dropdown" halign="right">
          <paper-item>Move to</paper-item>
          <paper-item>Change labels</paper-item>
          <paper-item>Add star</paper-item>
          <paper-item>Mark not important</paper-item>
          <paper-item>Mute</paper-item>
          <paper-item>Report spam</paper-item>
          <paper-item>Report phishing</paper-item>
        </paper-dropdown>
      </paper-menu-button> -->

      <paper-button style="background:white"
        on-tap="openDialog" data-dialog="addpatient"
        raised>New patient</paper-button>

      <paper-item id="patientdetails" class="bottom" hidden="{{!selectedDetails}}">
        <span class="layout vertical flex">
          <span class="layout horizontal center justified">
            <span class="label">Born:</span>
            <span><time class="birth">{{selectedPatient.date_birth}}</time></span>
            <span class="label">Last visit:</span>
            <span><time>{{selectedPatient.updated}}</time></span>
          </span>
        </span>
      </paper-item>

      <div id="refresh" class="bottom fit layout horizontal center-center"
           on-transitionend="onRefreshTransitionEnd">
        <div>
          <!-- <paper-material class="fit" elevation="2" animated></paper-material> -->
          <paper-spinner id="refreshspinner"></paper-spinner>
        </div>
      </div>

    </paper-toolbar>

    <div content on-thread-archive="onThreadArchive">

      <template is="dom-if" if="{{_computeShowSpinner(threads, signedIn)}}">
        <div class="layout vertical center-center" style="height:100%">
          <paper-spinner active></paper-spinner>
        </div>
      </template>

      <!-- TODO: don't pass all messages, users, labels into mail-thread -->
      <iron-selector id="threadlist" multi activate-event=""
                     selected-attribute="selected"
                     selected-items="{{selectedThreads}}"
                     on-iron-select="_onThreadSelectChange"
                     on-iron-deselect="_onThreadSelectChange">
        <template is="dom-repeat" items="[[threads]]">
          <record-thread messages="[[item.messages]]"
                       labels="[[labelMap]]" users="[[users]]"
                       narrow="[[narrow]]"
                       on-thread-select="_onThreadTap"></record-thread>
        </template>
      </iron-selector>

     </div>
  </paper-scroll-header-panel>

</paper-drawer-panel>

<paper-toast id="toast" class="layout horizontal justified"
             duration="10000" text="{{toastMessage}}" visible="{{toastOpened}}"
             on-paper-overlay-open="onToastOpenClose"
             on-transitionend="onToastOpenClose">
  <div on-tap="undoAll" class="undo">Undo</div>
</paper-toast>

<paper-fab id="fab-fave" mini icon="favorite" hidden="{{!selectedPatient}}"
   on-tap="openDialog" data-dialog="addrecord"></paper-fab>
<paper-fab id="fab-done" mini icon="done" hidden="{{!selectedPatient}}"
   on-tap="openDialog" data-dialog="addrecord"></paper-fab>
<paper-fab id="fab-pill" mini icon="pill" hidden="{{!selectedPatient}}"
   on-tap="openDialog" data-dialog="addrecord"></paper-fab>
<paper-fab id="fab" icon="create" hidden="{{!selectedPatient}}"
   on-tap="openDialog" data-dialog="addrecord"></paper-fab>

<!-- Cache data requests. -->
<!--<iron-localstorage name="polymer-mail-user" value="{{user}}"></iron-localstorage>-->
<!--<iron-localstorage name="polymer-mail-labels" value="{{labels}}"></iron-localstorage>-->
<!--<iron-localstorage name="polymer-mail-threads" value="{{threads}}"></iron-localstorage>-->
<!--<iron-localstorage name="polymer-mail-users" value="{{users}}"></iron-localstorage>-->

</template>

<!--<script src="scripts/polymer_metrics.js"></script>-->
<script src="app.js"></script>
<script>
  <!-- analytics -->
</script>
</body>
</html>
